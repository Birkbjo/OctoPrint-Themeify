!function(e){function t(o){if(n[o])return n[o].exports;var s=n[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){n(1),e.exports=n(3)},function(e,t,n){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var s=function(e){return e&&e.__esModule?e:{default:e}}(n(2));$(function(){function e(e){ko.extenders.stripQuotes=function(e,t){var n=ko.pureComputed({read:e,write:function(t){var n=t.replace(/['"]+/g,"");e(n)}}).extend({notify:"always"});return n(e()),n};var t=this;t.classId="themeify",t.settings=e[0],t.ownSettings={},t.customRules=[],t._ownSettingsPrev={},t.configSubscriptions={enabled:"",theme:""},t.tabIcons={},t.oldTabContent={},t.init=function(){t.customRuleStyleSheet=s.default.createStyleSheet("themeify-customStyleSheet",t.customRules),t.builtInStyles=s.default.createStyleSheet("themeify-builtInStyleSheet",t.ownSettings.color),t.enableBeforeLoaded()},t.onStartupComplete=function(){var e=$("html").attr("id");e&&"touch"==e&&$("html").removeClass(t.classId),console.log(t),t.updateColors(),t._updateCustomRules()},t.setupIcons=function(){t.tabIcons.tabs().filter(function(e){return e.domId()&&e.enabled()}).map(function(e,n){var o=e.domId,s=(e.enabled,e.faIcon),l=$("<i>",{class:s()}),u=$("".concat(o()," a"));u&&"tabs"===u.closest("ul").attr("id")?(t.oldTabContent[o()]=$("".concat(o()," a")).html(),u.html(l)):console.warn("Themeify: Failed to add icon! ".concat(o()," is not a child of the tab-list!"))})},t.restoreTabs=function(){t.tabIcons.tabs().filter(function(e){return e.domId()}).map(function(e,n){var o=e.domId,s=(e.enabled,e.faIcon,t.oldTabContent[o()]);s&&$("".concat(o()," a")).html(s)})},t.enableBeforeLoaded=function(){var e=localStorage.getItem("theme");e&&$("html").addClass(t.classId).addClass(e)},t.enableTheming=function(){if(t.ownSettings.enabled()&&"touch"!==$("html").attr("id")){var e=t.ownSettings.theme();localStorage.setItem("theme",e),$("html").addClass(t.classId).addClass(t.ownSettings.theme())}},t.addNewCustomRule=function(){var e={selector:ko.observable("").extend({stripQuotes:!0}),rule:ko.observable("").extend({stripQuotes:!0}),value:ko.observable(""),enabled:ko.observable(!0)};t._subscribeToDictValues(e,"customRules",t.customRules().length),t.ownSettings.customRules.push(e),t.customRuleStyleSheet.addRule(e)},t.addNewIcon=function(){var e={domId:ko.observable("").extend({stripQuotes:!0}),enabled:ko.observable(!0),faIcon:ko.observable("")};t._subscribeToDictValues(e,"tabs",t.onIconChange),t.tabIcons.tabs.push(e)},t.onBeforeBinding=function(){t.settings=t.settings.settings,t.ownSettings=t.settings.plugins.themeify,t.customRules=t.ownSettings.customRules.extend({rateLimit:50}),t.onRuleToggle=t.onRuleToggle,t.tabIcons={enabled:t.ownSettings.tabs.enableIcons,tabs:t.ownSettings.tabs.icons},t.tabIcons.enabled()&&t.setupIcons(),t.enableTheming(),t.customRuleStyleSheet.initWithRules(t.customRules),t.builtInStyles.initWithRules(t.ownSettings.color)},t.updateColors=function(){t.ownSettings.enableCustomization()&&t.ownSettings.color().filter(function(e){return!!e.enabled()}).map(function(e,n){t._applyRule(e,!0)})},t._updateCustomRules=function(){t.updateColors(),t.ownSettings.enableCustomization()&&t.ownSettings.customRules().filter(function(e){return!!e.enabled()}).map(function(e){t._applyRule(e)})},t._applyRule=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1],!e.selector()||e.rule()},t.clone=function(e){if("function"==typeof e)return e();if(null===e||"object"!==o(e)||"isActiveClone"in e)return e;if(e instanceof Date)var n=new e.constructor;else var n=e.constructor();for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(e.isActiveClone=null,n[s]=t.clone(e[s]),delete e.isActiveClone);return n},t._copyOwnSettings=function(){Object.keys(t.ownSettings).forEach(function(e,n){t._ownSettingsPrev[e]=t.clone(t.ownSettings[e])})},t.onColorChange=function(e,n,o){console.log("color change",e,o),t.builtInStyles.updateRule(e,o)},t.onCustomRuleChange=function(e,n,o){console.log("rule change",e,o),e.rule()&&e.selector()&&e.value()&&t.customRuleStyleSheet.updateRule(e,o)},t.onThemeChange=function(e){var t=localStorage.getItem("theme");(function(e){return $("html").hasClass(e)})(e)||(localStorage.setItem("theme",e),$("html").addClass(e).removeClass(t))},t.onEnabledChange=function(e){e&&"touch"!==$("html").attr("id")?t.enableTheming():($("html").removeClass(t.classId),localStorage.setItem("theme",!1),t.customRuleStyleSheet.disable())},t.onEnableCustomizationChange=function(e){e?t.customRuleStyleSheet.enable():t.customRuleStyleSheet.disable()},t.onIconsEnableChange=function(e){e?t.setupIcons():t.restoreTabs()},t.onIconChange=function(e,n,o,s){t.tabIcons.enabled()&&("enabled"!==s||n||t.restoreTabs(),t.setupIcons())},t.onRuleToggle=function(e){e.enabled(!e.enabled())},t.ruleIsDeleteable=function(e){return!e.deletable||"function"!=typeof e.deletable||e.deletable()},t.onCustomRuleDelete=function(e,n){t.ruleIsDeleteable(e)&&(t.customRuleStyleSheet.deleteRule(n()),t.customRules.remove(e))},t.onIconDelete=function(e){t.restoreTabs(),t.tabIcons.tabs.remove(e),t.setupIcons()},t._subscribeToDictValues=function(e,n,o,s){var l=s?s.bind(this,e):t.onCustomRuleChange.bind(this,e);Object.keys(e).map(function(s){t.configSubscriptions[n].push(e[s].subscribe(function(e){return l(e,o,s)}))})},t.onSettingsShown=function(){Object.keys(t.ownSettings).map(function(e){if("customRules"==e)t.configSubscriptions[e]=[],t.customRules().map(function(n,o){console.log("sub",o),t._subscribeToDictValues(n,e,o)});else if("color"==e){t.configSubscriptions[e]=[];var n=t.onColorChange;t.ownSettings.color().map(function(o,s){t._subscribeToDictValues(o,e,s,n)})}else if("tabs"==e){var o=t.configSubscriptions[e]=[],s=t.tabIcons,l=s.enabled,u=s.tabs;o.push(l.subscribe(t.onIconsEnableChange)),u().map(function(n,o){t._subscribeToDictValues(n,e,t.onIconChange)})}else{var i=t.configOnChangeMap[e];t.configSubscriptions[e]=t.ownSettings[e].subscribe(i)}})},t.onSettingsHidden=function(){Object.keys(t.configSubscriptions).map(function(e,n){Array.isArray(t.configSubscriptions[e])?t.configSubscriptions[e].forEach(function(e){e.dispose()}):t.configSubscriptions[e].dispose()})},t.configOnChangeMap={enabled:t.onEnabledChange,theme:t.onThemeChange,enableCustomization:t.onEnableCustomizationChange},t.init()}OCTOPRINT_VIEWMODELS.push({construct:e,dependencies:["settingsViewModel"],elements:["#settings_plugin_themeify"]})})},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function l(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function u(e){var t=e.selector,n=e.rule,o=e.value,s="".concat(t()," { ").concat(n(),": ").concat(o()," !important; }");return console.log(s),s}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=function(){function e(t,n){o(this,e),this.rules=n,this.styleSheet=t.sheet,this.rulesIndexToSheetRule=[],this.domElement=t}return l(e,[{key:"initWithRules",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.rules;this.rules=t,t().forEach(function(t,n){t.enabled()&&e.addRule(t,n)}),console.log(this.styleSheet.cssRules),console.log(this)}},{key:"addRule",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.styleSheet.cssRules.length;void 0===t&&(t=this.rules().length-1);var o=u(e);this.styleSheet.insertRule(o,n);var s=this.styleSheet.cssRules[n];return this.rulesIndexToSheetRule[t]=s,s}},{key:"deleteRule",value:function(e,t){return void 0===t&&(t=this.getCSSRulesIndexByRuleIndex(e)),t>-1?(this.styleSheet.deleteRule(t),delete this.rulesIndexToSheetRule[e],t):-1}},{key:"disable",value:function(){self.styleSheet.disabled=!0}},{key:"enable",value:function(){self.styleSheet.disabled=!1}},{key:"updateRule",value:function(e,t){var n=this.deleteRule(t);if(e.enabled()){var o=n>-1?n:void 0;return this.addRule(e,t,o)}return null}},{key:"getCSSRulesIndexByRuleIndex",value:function(e){var t=this.rulesIndexToSheetRule[e];if(!t)return-1;for(var n=0;n<this.styleSheet.cssRules.length;n++)if(this.styleSheet.cssRules[n]===t)return n;return-1}}],[{key:"createStyleSheet",value:function(t,n){var o=document.createElement("style");return o.title=t,$("html").addClass(o.title),document.head.appendChild(o),new e(o,n)}}]),e}(),a=i;t.default=a},function(e,t){}]);